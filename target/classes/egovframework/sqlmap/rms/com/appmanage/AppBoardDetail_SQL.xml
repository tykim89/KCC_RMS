<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="appBoardDetail">
	<typeAlias alias="appUserDetailVO" type="rms.com.appdoc.vo.AppUserDetailVO" />
	<typeAlias alias="appItemContentVO" type="rms.com.appdoc.vo.AppItemContentVO" />
	<typeAlias alias="appUserVO" type="rms.com.appdoc.vo.AppUserVO" />
	<typeAlias alias="appInfoVO" type="rms.com.appmanage.vo.AppInfoVO" />
	<typeAlias alias="appBaseInfoVO" type="rms.com.appmanage.vo.AppBaseInfoVO" />


	<!-- 입사지원자의 입사지원서 조회 -->
	<select id="appBoardDetailDAO.getAppUserInfoAction" resultClass="appUserDetailVO">
		<!-- SELECT 	DISTINCT AU.APP_USER_NO, AU.APP_USER_NAME, RF.REC_FIELD_NAME, AIC.LIST_NO,
				RN.REC_NOTI_TITLE, AA.DETAIL_CODE_NAME AS career_div_code,
				A.APP_ITEM_CONTENT AS ENG_NAME, B.APP_ITEM_CONTENT AS BIRTH_DAY,
				C.APP_ITEM_CONTENT AS PHONE_NUM, AU.APP_USER_EMAIL_ADDR,
				D.APP_ITEM_CONTENT AS POST_NUM, E.APP_ITEM_CONTENT AS ADDR, F.APP_ITEM_CONTENT AS
				ADDR_DETAIL, G.APP_ITEM_CONTENT AS TEL_NUM, H.APP_ITEM_CONTENT AS gender, AU.VERSION
		FROM 	APP_USER AU, REC_FIELD RF, REC_NOTI RN, AFF AF, APP_ITEM_CONTENT AIC,
				(SELECT DETAIL_CODE, DETAIL_CODE_NAME
				FROM CODE_DETAIL
				WHERE GROUP_CODE = 'CAREER_DIV') AA,
				(SELECT AIC.APP_USER_NO, AIL.APP_ITEM_NAME, AIC.APP_ITEM_CONTENT
				FROM APP_ITEM_CONTENT AIC, APP_ITEM_LIST AIL
				WHERE AIC.APP_ITEM_NO = AIL.APP_ITEM_NO
				AND AIC.APP_LIST_CODE = AIL.APP_LIST_CODE
				AND AIL.APP_ITEM_NO = 'PSINFO001'
				AND AIL.APP_LIST_CODE = 'PSINFO01') A,
				(SELECT AIC.APP_USER_NO, AIL.APP_ITEM_NAME, AIC.APP_ITEM_CONTENT
				FROM APP_ITEM_CONTENT AIC, APP_ITEM_LIST AIL
				WHERE AIC.APP_ITEM_NO = AIL.APP_ITEM_NO
				AND AIC.APP_LIST_CODE = AIL.APP_LIST_CODE
				AND AIL.APP_ITEM_NO = 'PSINFO002'
				AND AIL.APP_LIST_CODE = 'PSINFO01')B,
				(SELECT AIC.APP_USER_NO, AIL.APP_ITEM_NAME, AIC.APP_ITEM_CONTENT
				FROM APP_ITEM_CONTENT AIC, APP_ITEM_LIST AIL
				WHERE AIC.APP_ITEM_NO = AIL.APP_ITEM_NO
				AND AIC.APP_LIST_CODE = AIL.APP_LIST_CODE
				AND AIL.APP_ITEM_NO = 'PSINFO003'
				AND AIL.APP_LIST_CODE = 'PSINFO01')C,
				(SELECT AIC.APP_USER_NO, AIL.APP_ITEM_NAME, AIC.APP_ITEM_CONTENT
				FROM APP_ITEM_CONTENT AIC, APP_ITEM_LIST AIL
				WHERE AIC.APP_ITEM_NO = AIL.APP_ITEM_NO
				AND AIC.APP_LIST_CODE = AIL.APP_LIST_CODE
				AND AIL.APP_ITEM_NO = 'PSINFO004'
				AND AIL.APP_LIST_CODE = 'PSINFO01')D,
				(SELECT AIC.APP_USER_NO, AIL.APP_ITEM_NAME, AIC.APP_ITEM_CONTENT
				FROM APP_ITEM_CONTENT AIC, APP_ITEM_LIST AIL
				WHERE AIC.APP_ITEM_NO = AIL.APP_ITEM_NO
				AND AIC.APP_LIST_CODE = AIL.APP_LIST_CODE
				AND AIL.APP_ITEM_NO = 'PSINFO005'
				AND AIL.APP_LIST_CODE = 'PSINFO01') E,
				(SELECT AIC.APP_USER_NO, AIL.APP_ITEM_NAME, AIC.APP_ITEM_CONTENT
				FROM APP_ITEM_CONTENT AIC, APP_ITEM_LIST AIL
				WHERE AIC.APP_ITEM_NO = AIL.APP_ITEM_NO
				AND AIC.APP_LIST_CODE = AIL.APP_LIST_CODE
				AND AIL.APP_ITEM_NO = 'PSINFO006'
				AND AIL.APP_LIST_CODE = 'PSINFO01') F,
				(SELECT AIC.APP_USER_NO, AIL.APP_ITEM_NAME, AIC.APP_ITEM_CONTENT
				FROM APP_ITEM_CONTENT AIC, APP_ITEM_LIST AIL
				WHERE AIC.APP_ITEM_NO = AIL.APP_ITEM_NO
				AND AIC.APP_LIST_CODE = AIL.APP_LIST_CODE
				AND AIL.APP_ITEM_NO = 'PSINFO007'
				AND AIL.APP_LIST_CODE = 'PSINFO01') G,
				(SELECT AIC.APP_USER_NO, AIL.APP_ITEM_NAME, AIC.APP_ITEM_CONTENT
				FROM APP_ITEM_CONTENT AIC, APP_ITEM_LIST AIL
				WHERE AIC.APP_ITEM_NO = AIL.APP_ITEM_NO
				AND AIC.APP_LIST_CODE = AIL.APP_LIST_CODE
				AND AIL.APP_ITEM_NO = 'PSINFO008'
				AND AIL.APP_LIST_CODE = 'PSINFO01') H
		WHERE 	RF.REC_FIELD_NO = RN.REC_FIELD_NO
		AND 	RN.REC_NOTI_NO = AU.REC_NOTI_NO
		AND		AF.AFF_NO = RF.AFF_NO
		AND 	RN.CAREER_DIV_CODE = AA.DETAIL_CODE
		AND 	AU.APP_USER_NO = #app_user_no#
		AND 	AU.APP_USER_NO = A.APP_USER_NO
		AND 	AU.APP_USER_NO = B.APP_USER_NO
		AND 	AU.APP_USER_NO = C.APP_USER_NO
		AND 	AU.APP_USER_NO = D.APP_USER_NO
		AND 	AU.APP_USER_NO = E.APP_USER_NO
		AND 	AU.APP_USER_NO = F.APP_USER_NO
		AND 	AU.APP_USER_NO = G.APP_USER_NO
		AND 	AU.APP_USER_NO = H.APP_USER_NO -->
	</select>

	<!-- 입사지원자의 이름, id 정보 조회 -->
	<select id="appBoardDetailDAO.getAppUserIdAction" resultClass="appUserVO">
		SELECT APP_USER_NO, APP_USER_NAME
		FROM APP_USER
		WHERE APP_USER_NO = #app_user_no#
	</select>
	
	<!-- 입사지원서 수정 -->
	<update id="appBoardDetailDAO.updateAppUserOfPsInfoAction" parameterClass="appInfoVO">
		UPDATE 	APP_ITEM_CONTENT
		SET		APP_ITEM_CONTENT= #app_item_content#			
		WHERE  	APP_USER_NO = #app_user_no#
	    AND 	APP_ITEM_NO = #key#
	    AND		APP_LIST_CODE = #app_list_code#
	    
	</update>
	<!--  -->
	<select id="appBoardDetailDAO.getAppUserDetailAction" parameterClass="appInfoVO" resultClass="appItemContentVO">
	<![CDATA[
		SELECT AIL.APP_ITEM_NO, AIL.APP_LIST_CODE, AIL.APP_ITEM_NAME, AIC.APP_ITEM_CONTENT, AFIL.SORT_SEQ, AIC.LIST_NO
		FROM APP_ITEM_CONTENT AIC, APP_FORM_ITEM_LIST AFIL, APP_ITEM_LIST AIL, APP_FORM AF
		WHERE AF.APP_FORM_NO = AFIL.APP_FORM_NO
		AND AIL.APP_ITEM_NO = AFIL.APP_ITEM_NO
		AND AIL.APP_LIST_CODE = AFIL.APP_LIST_CODE
		AND AIC.APP_ITEM_NO = AFIL.APP_ITEM_NO
		AND AIC.APP_LIST_CODE = AFIL.APP_LIST_CODE
		AND AIL.APP_LIST_CODE = #app_list_code#
		AND AIC.APP_USER_NO = #app_user_no#
		AND AIC.REC_NOTI_NO = #rec_noti_no#
		ORDER BY CAST(AIC.LIST_NO AS INT), CAST(AFIL.SORT_SEQ AS INT)
	]]>
	</select>
	
	<!-- 양식별 구성사항목록 -->
	<select id="appBoardDetailDAO.getFormItemListAction" resultClass="appItemContentVO">
	<![CDATA[
		SELECT DISTINCT A.DETAIL_CODE AS APP_LIST_CODE, A.DETAIL_CODE_NAME AS APP_LIST_CODE_NAME, A.SORT_SEQ
		FROM (SELECT DETAIL_CODE, DETAIL_CODE_NAME, SORT_SEQ
			 FROM CODE_DETAIL
			 WHERE GROUP_CODE = 'APP_ITEM') A, APP_FORM_ITEM_LIST AFIL
		WHERE AFIL.APP_FORM_NO = (SELECT APP_FORM_NO 
								FROM REC_NOTI 
								WHERE REC_NOTI_NO = (SELECT REC_NOTI_NO 
													FROM APP_USER 
													WHERE APP_USER_NO = #app_user_no#)) 
		AND AFIL.APP_LIST_CODE = A.DETAIL_CODE
		ORDER BY CAST(A.SORT_SEQ AS INT)
	]]>
	</select>
	
	<select id="appBoardDetailDAO.getAppUserBaseinfoAction" resultClass="appBaseInfoVO">
	<![CDATA[
		SELECT 	DISTINCT AU.APP_USER_NAME, AU.APP_USER_EMAIL_ADDR,
				RF.REC_FIELD_NAME, RN.REC_NOTI_TITLE, AU.APP_USER_NO,RN.REC_NOTI_NO,
				AA.DETAIL_CODE_NAME AS career_div_code
				
		FROM 	APP_USER AU, REC_FIELD RF, APP_ITEM_CONTENT AIC, 
				REC_NOTI RN, (	SELECT DETAIL_CODE, DETAIL_CODE_NAME
								FROM CODE_DETAIL
								WHERE GROUP_CODE = 'CAREER_DIV') AA
				
				
		WHERE 	RF.REC_FIELD_NO = RN.REC_FIELD_NO
		AND 	RN.REC_NOTI_NO = AU.REC_NOTI_NO
		AND 	RN.CAREER_DIV_CODE = AA.DETAIL_CODE
		AND 	AU.APP_USER_NO = #app_user_no#

	]]>
	</select>
		
	
	
	<!-- 입사지원서에 해당하는 지원자의 사진 가져오기 -->
	<select id="appBoardDetailDAO.getImage" parameterClass="String" resultClass="appUserVO">
		SELECT 	AU.APP_USER_NO, 
						AT.ATT_FILE_NO, 
						AT.ATT_FILE_NAME, 
						AT.ATT_FILE_ORIG_NAME, 
						AT.ATT_FILE_SAVE_PATH,
						AT.ATT_FILE_EXTENTION
		FROM    	APP_USER AU, 
						ATT_FILE AT
		WHERE   	AU.ATT_FILE_NO = AT.ATT_FILE_NO
		AND     		APP_USER_NO = #app_user_no#
	</select>
	
	
	
</sqlMap>