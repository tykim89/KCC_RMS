<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<!-- 
	수정일                 수정자                          수정내용
  =========     =======    =================================================
  2011.8.26   	 서준식     	 	SSO 로그인을 위한 쿼리 추가
  2011.09.27    서준식              컬럼 변경 SUB_DN 을  CRTFC_DN_VALUE 로 변경
  2011.09.28    서준식              컬럼 변경 entrprsmber_id 을  ENTRPRS_MBER_ID 로 변경
-->

<sqlMap namespace="RecNoticeManage">


	<!-- 별칭주기 -->
	<typeAlias  alias="recNotice" type="rms.com.recNotice.vo.RecNoticeVO"/>
	<typeAlias  alias="recFieldVO" type="rms.com.jal.vo.RecFieldVO"/>
	<typeAlias alias="pagingVO" type="rms.com.qna.qnafrq.vo.DefaultVO"/>

	
	<!-- 채용공고 목록조회, 검색조회 -->
	<select id="recNoticeList" parameterClass="pagingVO" resultClass="recNotice">
		<![CDATA[ 
		select 	no, rec_noti_no,  career_div_code, rec_year, rec_field_name, 
					rec_noti_title, rec_start_date, rec_end_date, state_code, hits
        from (
        		select rownum rnum, s.*
        		from (
						select 	RANK() over(ORDER BY rn.write_date ASC) as no, rn.rec_noti_no,  
							          (SELECT detail_code_name 
							           FROM code_detail 
							           WHERE detail_code = career_div_code ) as career_div_code, 
						            rn.rec_year, rf.rec_field_name, rn.rec_noti_title, rn.rec_start_date, rn.rec_end_date,
							          (SELECT detail_code_name 
							           FROM code_detail 
							           WHERE detail_code = state_code ) as state_code,
						            rn.hits
						from 		REC_NOTI rn, REC_FIELD rf
						where 	rn.REC_FIELD_NO = rf.REC_FIELD_NO
						and    	rn.enable_tf = 'T'
			]]>
			<isEqual property="searchCondition" compareValue="rec_noti_title">
				AND upper(rn.rec_noti_title) LIKE upper('%'||#searchKeyword#||'%')
			</isEqual>

			<isEqual property="searchCondition" compareValue="rec_noti_content">
				AND upper(rn.rec_noti_content) LIKE upper('%'||#searchKeyword#||'%')
			</isEqual>

			<isNotEmpty property="rec_year">
				AND rn.rec_year = #rec_year#
			</isNotEmpty>
		
			<isNotEmpty property="career_div_code">
				AND rn.career_div_code  = #career_div_code#
			</isNotEmpty>
			
			<isNotEmpty property="state_code">
				AND (SELECT detail_code_name 
	             		FROM code_detail 
	              		WHERE detail_code = state_code ) = #state_code#
			</isNotEmpty>
			
			<isNotNull property="recFieldList">
					AND rf.rec_field_name
				<iterate prepend="IN" property="recFieldList" open="(" close=")" conjunction=","> 
		      	 	#recFieldList[]# 
		    	</iterate>
	    	</isNotNull>

		<![CDATA[ 
			order by rn.write_date desc
			
			)s
		)
		
		where rownum <= #recordCountPerPage# and rnum > #firstIndex# 
		]]>
	</select>
	<!--입사지원서 검색/조회 끝  -->

	<!--입사지원서 검색/조회 시작 -->
	<select id="getRecFieldListAction" resultClass="recFieldVO">
		<![CDATA[
			SELECT DISTINCT rec_field_name 
			FROM rec_field
		]]>
	</select>
	
	
	
	<!-- 채용공고 상세조회 -->
	<select id="recNoticeContent" parameterClass="String" resultClass="recNotice">
		select    rn.rec_noti_no, rf.rec_field_name, 
		           (SELECT detail_code_name 
		            FROM code_detail 
		            WHERE detail_code = career_div_code ) as career_div_code, 
		            rp.rec_prog_name, af.app_form_name, rn.rec_start_date, rn.rec_end_date, rn.announce_date, 
		            rn.check_start_date, rn.check_end_date, rn.rec_noti_title, rn.rec_noti_content, 
		          (SELECT detail_code_name 
		            FROM code_detail 
		            WHERE detail_code = att_file_code ) as att_file_code,
		            rn.rec_year, 
		          (SELECT detail_code_name 
		            FROM code_detail 
		            WHERE detail_code = state_code ) as state_code, 
		            rn.writer, rn.write_date,
		            rn.HUBMAIN_VIEW_TF, rn.MAIN_VIEW_TF, rn.FRONT_VIEW_TF
		from REC_NOTI rn, REC_FIELD rf, APP_FORM af, REC_PROG rp
		where rn.REC_PROG_NO = rp.REC_PROG_NO
		and   rn.REC_FIELD_NO = rf.REC_FIELD_NO
		and   rn.APP_FORM_NO = af.APP_FORM_NO
		and   rn.REC_NOTI_NO = #REC_NOTI_NO#
	</select>
	
	
	<!-- 조회수 증가 -->
	<update id="recNoticeDAO.readcountUp" parameterClass="java.util.HashMap">
		UPDATE	 REC_NOTI
   		SET		 HITS = HITS+1
 		WHERE	 REC_NOTI_NO = #rec_noti_no#
	</update>
	
	
	
	<!-- 채용공고 등록 -->
	<insert id="recNoticeInsert" parameterClass="recNotice">
		insert into REC_NOTI(REC_NOTI_NO, REC_NOTI_TITLE, REC_NOTI_CONTENT, REC_START_DATE, REC_END_DATE, ANNOUNCE_DATE, WRITER, 
            WRITE_DATE, ENABLE_TF, VERSION, HITS, STATE_CODE, REC_FIELD_NO, AFF_NO, CHECK_END_DATE, CHECK_START_DATE, REC_YEAR, 
            CAREER_DIV_CODE, REC_PROG_NO, APP_FORM_NO, ATT_FILE_CODE, HUBMAIN_VIEW_TF, MAIN_VIEW_TF, FRONT_VIEW_TF)
		values (#rec_noti_no#, #rec_noti_title#, #rec_noti_content#, #rec_start_date#, #rec_end_date#, #announce_date#, #writer#, 
        	sysdate, 'T', 1, 0, #state_code#, #rec_field_no#, #aff_no#, #check_end_date#, #check_start_date#, #rec_year#, 
       		#career_div_code#, #rec_prog_no#, #app_form_no#, #att_file_code#, #hubmain_view_tf#, #main_view_tf#, #front_view_tf#)
	</insert>
	
	
	<!-- 채용공고 수정 -->
	<update id="recNoticeUpdate" parameterClass="recNotice">
		update REC_NOTI
		set	  rec_noti_title = #rec_noti_title#, rec_noti_content = #rec_noti_content#, rec_start_date = to_date(#rec_start_date#,'YY/MM/DD'), 
				  rec_end_date = to_date(#rec_end_date#,'YY/MM/DD'), 
				  announce_date = to_date(#announce_date#,'YY/MM/DD'), modifier = #modifier#, modi_date = sysdate, version = version + 1,
        	      state_code = #state_code#, rec_field_no = #rec_field_no#, aff_no = #aff_no#, check_end_date = to_date(#check_end_date#,'YY/MM/DD'), 
        	      check_start_date = to_date(#check_start_date#,'YY/MM/DD'), rec_year = #rec_year#, career_div_code = #career_div_code#,
       		      rec_prog_no = #rec_prog_no#, app_form_no = #app_form_no#, att_file_code = #att_file_code#, 
       		      hubmain_view_tf = #hubmain_view_tf#, main_view_tf = #main_view_tf#, front_view_tf = #front_view_tf#
		where  rec_noti_no = #rec_noti_no#
	</update>
	
	
	<!-- 채용공고 삭제 -->
	<update id="recNoticeDelete" parameterClass="String">
		UPDATE  REC_NOTI
		SET		ENABLE_TF = 'F'
		WHERE	REC_NOTI_NO = #rec_noti_no#
	</update>
	
	
	
		<!-- 페이지 토탈 카운트 -->
	<select id="recNoticeDAO.selectSampleListTotCnt" parameterClass="pagingVO" resultClass="int">
		SELECT 	COUNT(*) totcnt
		FROM 	REC_NOTI rn, REC_FIELD rf
		WHERE 	rn.REC_FIELD_NO = rf.REC_FIELD_NO
		AND	 	rn.enable_tf = 'T'
				<isEqual property="searchCondition" compareValue="rec_noti_title">
					AND upper(rn.rec_noti_title) LIKE upper('%'||#searchKeyword#||'%')
				</isEqual>
	
				<isEqual property="searchCondition" compareValue="rec_noti_content">
					AND upper(rn.rec_noti_content) LIKE upper('%'||#searchKeyword#||'%')
				</isEqual>
	
				<isNotEmpty property="rec_year">
					AND rn.rec_year = #rec_year#
				</isNotEmpty>
			
				<isNotEmpty property="career_div_code">
					AND rn.career_div_code  = #career_div_code#
				</isNotEmpty>
				
				<isNotEmpty property="state_code">
					AND (SELECT detail_code_name 
		             		FROM code_detail 
		              		WHERE detail_code = state_code ) = #state_code#
				</isNotEmpty>
				
				<isNotNull property="recFieldList">
					AND rf.rec_field_name
				<iterate prepend="IN" property="recFieldList" open="(" close=")" conjunction=","> 
		      	 	#recFieldList[]# 
		    	</iterate>
	    	</isNotNull>
	</select>
	
	
</sqlMap>
