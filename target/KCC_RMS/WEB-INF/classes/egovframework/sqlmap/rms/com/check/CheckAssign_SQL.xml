<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="checkAssign">
	<typeAlias alias="checkAssignVO" type="rms.com.check.vo.CheckAssignVO" />
	<typeAlias alias="assignedUserVO" type="rms.com.check.vo.AssignedUserVO" />
	<typeAlias alias="adminVO" type="rms.com.sys.vo.AdminVO" />
	<typeAlias alias="checkResVO" type="rms.com.check.vo.CheckResVO" />

	<select id="checkAssignDAO.getRecFieldAction" resultClass="checkAssignVO">
		<![CDATA[
			SELECT REC_NOTI_NO, REC_NOTI_TITLE
			FROM REC_NOTI
			WHERE ENABLE_TF = 'T'
		]]>
	</select>

	<select id="checkAssignDAO.getCompanyAction" resultClass="adminVO">
		<![CDATA[
			SELECT COMPANY_NO, COMPANY_NAME
			FROM COMPANY
			WHERE ENABLE_TF = 'T'
		]]>
	</select>

	<select id="checkAssignDAO.getDeptAction" resultClass="adminVO">
		<![CDATA[
			SELECT DEP_NO, DEP_NAME
			FROM DEPT
			WHERE ENABLE_TF = 'T'
		]]>
	</select>

	<select id="checkAssignDAO.getPositionAction" resultClass="adminVO">
		<![CDATA[
			SELECT DETAIL_CODE_NAME AS detail_code_name, DETAIL_CODE AS position_code
			FROM CODE_DETAIL
			WHERE GROUP_CODE = 'POSITION'
		]]>
	</select>


	<!--추가시, 미할당된 지원자리스트 빼기 -->
	<select id="checkAssignDAO.getAddUnassignedUsrAction"
		parameterClass="java.util.Map" resultClass="AssignedUserVO">
		<![CDATA[
			SELECT DISTINCT AU.APP_USER_NO, AU.APP_USER_NAME 
			FROM CHECK_RES CR, APP_USER AU	
			WHERE CR.APP_USER_NO = AU.APP_USER_NO
			AND CR.APP_USER_NO NOT IN (SELECT APP_USER_NO
			FROM CHECK_RES	
			WHERE ADMIN_ID = #adminTarget# )
			AND CR.REC_NOTI_NO = #recFieldNo#
		]]>
		
		<isNotNull property="list">
			AND AU.APP_USER_NO
			<iterate prepend="NOT IN" property="list" open="(" close=")"
				conjunction=",">
				#list[]#
			</iterate>
		</isNotNull>
	</select>

	<select id="checkAssignDAO.getRemoveUnassignedUsrAction"
		parameterClass="java.util.Map" resultClass="AssignedUserVO">
		<![CDATA[
			SELECT AU.APP_USER_NO, AU.APP_USER_NAME
			FROM APP_USER AU, REC_NOTI RN
			WHERE AU.REC_NOTI_NO = RN.REC_NOTI_NO
			AND RN.REC_NOTI_NO = #recFieldNo#
		]]>
		<isNotNull property="list">
			AND AU.APP_USER_NO
			<iterate prepend="NOT IN" property="list" open="(" close=")"
				conjunction=",">
				#list[]#
			</iterate>
		</isNotNull>
	</select>

	<!--추가시, 할당된 지원자리스트 더하기 -->
	<select id="checkAssignDAO.getAddAssignedUsrAction"
		parameterClass="java.util.Map" resultClass="AssignedUserVO">
		<![CDATA[
			SELECT AU.APP_USER_NO, AU.APP_USER_NAME
			FROM APP_USER AU, REC_NOTI RN
			WHERE AU.REC_NOTI_NO = RN.REC_NOTI_NO
			
		]]>
		<isNotNull property="list">
			AND AU.APP_USER_NO
			<iterate prepend="IN" property="list" open="(" close=")"
				conjunction=",">
				#list[]#
			</iterate>
		</isNotNull>
	</select>

	<select id="checkAssignDAO.getRemoveAssignedUsrAction"
		parameterClass="java.util.Map" resultClass="AssignedUserVO">
		<![CDATA[
			SELECT AU.APP_USER_NO, AU.APP_USER_NAME
			FROM APP_USER AU, REC_NOTI RN
			WHERE AU.REC_NOTI_NO = RN.REC_NOTI_NO
			
		]]>
		<isNotNull property="list">
			AND AU.APP_USER_NO
			<iterate prepend="IN" property="list" open="(" close=")"
				conjunction=",">
				#list[]#
			</iterate>
		</isNotNull>
		<isNull property="list">
			AND 1=0
		</isNull>
	</select>

	<select id="checkAssignDAO.getAdminListAction" parameterClass="adminVO" resultClass="adminVO">
		<![CDATA[
			SELECT 	CO.COMPANY_NAME, DE.DEP_NAME, A.DETAIL_CODE_NAME, AD.ADMIN_NAME, AD.ADMIN_ID, AD.ADMIN_EMAIL_ADDR, AD.ADMIN_PHONE_NUM, AD.ADMIN_TEL_NUM
			FROM 	ADMIN AD, DEPT DE, COMPANY CO,
					(SELECT 	DETAIL_CODE, DETAIL_CODE_NAME
				 	 FROM 		CODE_DETAIL
				 	 WHERE 		GROUP_CODE = 'POSITION') A
			WHERE 	CO.COMPANY_NO = DE.COMPANY_NO
			AND 	DE.DEP_NO = AD.DEP_NO
			AND 	AD.POSITION_CODE = A.DETAIL_CODE
		]]>
		
		<isNotNull property="admin_name">
			AND AD.ADMIN_NAME LIKE '%'||#admin_name#||'%'
		</isNotNull>
		<isNotNull property="admin_id">
			AND AD.ADMIN_ID LIKE '%'||#admin_id#||'%'
		</isNotNull>
		<isNotEmpty property="company_no">
			AND CO.COMPANY_NO = #company_no#
		</isNotEmpty>
		<isNotEmpty property="dep_no">
			AND DE.DEP_NO = #dep_no#
		</isNotEmpty>
		<isNotEmpty property="position_code">
			AND AD.POSITION_CODE = #position_code#
		</isNotEmpty>
		<![CDATA[
			ORDER BY AD.ADMIN_NAME
		]]>
		
	</select>
	
	<select id="checkAssignDAO.getCheckUserListAction" parameterClass="java.lang.String" resultClass="adminVO">
		<![CDATA[
			SELECT 	CO.COMPANY_NAME, DE.DEP_NAME, A.DETAIL_CODE_NAME, AD.ADMIN_NAME, AD.ADMIN_ID, AD.ADMIN_EMAIL_ADDR, AD.ADMIN_PHONE_NUM, AD.ADMIN_TEL_NUM
			FROM 	ADMIN AD, DEPT DE, COMPANY CO,
					(SELECT 	DETAIL_CODE, DETAIL_CODE_NAME
				 	 FROM 		CODE_DETAIL
				 	 WHERE 		GROUP_CODE = 'POSITION') A
			WHERE 	CO.COMPANY_NO = DE.COMPANY_NO
			AND 	DE.DEP_NO = AD.DEP_NO
			AND 	AD.POSITION_CODE = A.DETAIL_CODE
			AND 	AD.ADMIN_ID = #adminTarget#
		]]>
	</select>
	
	<select id="checkAssignDAO.getCheckAssignUserListAction" parameterClass="java.lang.String" resultClass="checkResVO">
		<![CDATA[
			SELECT 		CR.APP_USER_NO, 	AU.APP_USER_NAME
			FROM 		CHECK_RES CR, 		APP_USER AU
			WHERE 		CR.APP_USER_NO = AU.APP_USER_NO
			AND 		CR.ADMIN_ID = #adminTarget#
		]]>
	</select>
	
	<select id="checkAssignDAO.userInfoListAction" parameterClass="java.util.Map" resultClass="checkResVO">
		<![CDATA[
			SELECT APP_USER_NO, AFF_NO, REC_FIELD_NO, REC_NOTI_NO
			FROM APP_USER
		]]>
			<isNotNull property="list">
				WHERE APP_USER_NO
				<iterate prepend="IN" property="list" open="(" close=")" conjunction=",">
						#list[]#
				</iterate>
			</isNotNull>
	</select>
	
	<insert id="checkAssignDAO.updateCheckAssginAction" parameterClass="checkResVO">
		<![CDATA[
			INSERT 	
			INTO 	CHECK_RES 	(ADMIN_ID, APP_USER_NO, AFF_NO, REC_FIELD_NO, REC_NOTI_NO,
								WRITER, WRITE_DATE, VERSION, ENABLE_TF)
			VALUES				(#admin_id#, #app_user_no#, #aff_no#, #rec_field_no#, #rec_noti_no#,
								'SYSTEM', SYSDATE, 1, 'T')
		
		]]>
	</insert>

</sqlMap>